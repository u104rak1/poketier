# poketier

## ディレクトリ構成

```
poketier/
├── backend/
│   ├── cmd/
│   │   └── poketier/
│   │       └── main.go           # エントリーポイント
│   ├── go.mod
│   └── go.sum
├── build/
│   └── Dockerfile_local          # 開発用Dockerfile
├── docker-compose.yml            # Docker構成
├── Makefile                      # 開発用コマンド
└── .vscode/
    └── launch.json               # VSCodeデバッグ設定
```

## 技術スタック

- **Backend**
   - **Go**: 1.24.4
   - **フレームワーク**: Gin
   - **ORM**: sqlc
   - **デバッガー**: Delve

## ローカル開発環境

### 仕組み
VSCodeでの開発を想定しています。
ホストマシンにDockerがインストールされている事を前提としています。

1. **Docker環境**：
   - `docker-compose up -d` でコンテナを起動
   - Goアプリケーションは手動で制御（安定性重視）
   - ポート：`28080`（アプリ）、`22345`（デバッガー）

2. **手動制御開発環境**：
   - **完全制御**: アプリの起動/停止を手動で管理
   - **デバッグ**: 必要な時にのみアタッチ

### 開発手順

#### 1. 環境構築

```bash
# コンテナをビルド・起動（Delveサーバーのみ起動）
make build && make up
```

#### 2. ローカル環境でバックエンドサーバーを動かす手順

1. **コンテナ起動**: `make up` でコンテナを永続化起動
2. **アプリケーション起動**: `make run` でDelveデバッガー + APIサーバーを同時起動
3. **VS Codeでデバッグ接続**: `F5` を押して "Attach to Backend Server" を選択
4. **ブレークポイント設定**: `backend/cmd/poketier/main.go` でブレークポイントを設定
5. **API動作確認**: `make health` でAPIの疎通確認
6. **コード変更後の再起動**: `make rerun` で停止→起動
7. **デバッガー再接続**: VS Codeで再度 `F5` を押してデバッガー再接続
8. ブレークポイントやログで動作確認
9. 作業終了後は `make down`でコンテナを停止

**🔧 効率的な開発のコツ**:
- **アプリ停止**: `make stop` でクリーンに停止
- **即座に再起動**: `make rerun` で stop→run を一括実行
- **接続確認**: `make health` でAPIの疎通確認

**⚠️ 重要: ブレークポイントの正しい設定順序**

1. **アタッチ**: F5を押して "Attach to Backend Server" を選択
2. **ブレークポイント設定**: アタッチ成功後にコードにブレークポイントを設定
3. **動作確認**: APIを呼び出してブレークポイントで停止することを確認

### ポート一覧

| サービス | ホスト | コンテナ | 用途 |
|---------|--------|----------|------|
| バックエンドサーバー | 28080 | 8080 | HTTP API |
| Delveデバッガー | 22345 | 2345 | リモートデバッグ |
