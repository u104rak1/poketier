# poketier

## ディレクトリ構成

```
poketier/
├── backend/
│   ├── apps/                     # コンテキスト毎に境界付けされたアプリケーション
│   │   └── tierlist/             # TierListアプリ
│   ├── cmd/
│   │   └── poketier/
│   │       └── main.go           # エントリーポイント
│   ├── env/                      # 環境変数
│   ├── pkg/                      # ユーティリティパッケージ
│   ├── sqlc/                     # sqlc関連
│   ├── go.mod
│   └── go.sum
├── build/
│   └── Dockerfile_local          # 開発用Dockerfile
├── docs/                         # ドキュメント
├── docker-compose.yml            # Docker構成
└── Makefile                      # 開発用コマンド
```

## 技術スタック

- **Backend**
   - **Go**: 1.24.4
   - **フレームワーク**: Gin
   - **ORM**: sqlc
   - **デバッガー**: Delve

## ローカル開発環境

### 仕組み
VSCodeでの開発を想定しています。ホストマシンにDockerがインストールされている事を前提としています。

1. Docker環境：
   - `docker-compose up -d` でコンテナを起動。開発に関わる全てをコンテナで管理。
      - バックエンドのGolangコンテナ
      - フロントエンドのNode.jsコンテナ
      - PostgreSQLコンテナ
      - Redisコンテナ

2. 手動制御開発環境：
   - **完全制御**: バックエンドアプリの起動/停止を手動で管理
   - **デバッグ**: 必要な時にのみアタッチ

### 開発手順

#### 1. 環境構築

```bash
# コンテナをビルド・起動（Delveサーバーのみ起動）
make build && make up
```

#### 2. ローカル環境でバックエンドサーバーを動かす手順

1. **コンテナ起動**: `make up` でコンテナを永続化起動
2. **アプリケーション起動**: `make run` でDelveデバッガー + APIサーバーを同時起動
3. **VS Codeでデバッグ接続**: `F5` を押して "Attach to Backend Server" を選択
4. **ブレークポイント設定**: ブレークポイントを設定
5. **API動作確認**: `make health` でAPIの疎通確認
6. **コード変更後の再起動**: `make rerun` で停止→起動
7. **デバッガー再接続**: VS Codeで再度 `F5` を押してデバッガー再接続
8. ブレークポイントやログで動作確認
9. 作業終了後は `make down`でコンテナを停止

**🔧 効率的な開発のコツ**:
- **アプリ停止**: `make stop` でクリーンに停止
- **即座に再起動**: `make rerun` で stop→run を一括実行

**⚠️ 重要: ブレークポイントの正しい設定順序**

1. **アタッチ**: F5を押して "Attach to Backend Server" を選択
2. **ブレークポイント設定**: アタッチ成功後にコードにブレークポイントを設定
3. **動作確認**: APIを呼び出してブレークポイントで停止することを確認

### ポート一覧

| サービス | ホスト | コンテナ | 用途 |
|---------|--------|----------|------|
| バックエンドサーバー | 28080 | 8080 | HTTP API |
| Delveデバッガー | 22345 | 2345 | リモートデバッグ |
