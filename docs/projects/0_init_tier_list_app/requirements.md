# PokeTier - 要件定義書 (Phase 0: 初期ティアリスト作成システム)

## 1. プロジェクト概要

### 1.1 プロジェクト背景
ポケポケの実況者コミュニティにおいて、デッキ（Deck）の強さを議論するためのティアリスト作成ツールが求められている。既存の汎用ツールでは、ポケポケ特有のニーズ（カード画像の自動提供、複数カード組み合わせでのデッキ表現、シーズン管理等）に対応できていない。

### 1.2 プロジェクト目標（Phase 0）
- ポケポケ特化の基本的なティアリスト作成機能構築
- シーズン（Season）ベースのデッキ管理機能提供
- コミュニティの集計ティアリスト（ConsensusTierList）表示

## 2. 業務要件

### 2.1 業務フロー

#### 2.1.1 ティアリスト作成フロー（TierListCreation）
```
[ユーザー] → [サイト訪問] → [アクティブシーズン選択] → [デッキ選択/作成] → [ティア配置] → [ティアリスト保存] → [共有]
```

#### 2.1.2 デッキ作成フロー（DeckAggregate）
```
[ユーザー] → [カード検索] → [カード選択（1-3枚）] → [デッキニックネーム入力] → [画像合成（ImageComposition）] → [デッキ保存]
```

#### 2.1.3 集計処理フロー（StatisticsCalculation）
```
[システム] → [定期実行] → [全ティアリスト分析] → [集計ティアリスト計算] → [統計更新] → [ConsensusTierList公開]
```

### 2.2 ステークホルダー
- **エンドユーザー**: ポケポケ実況者・視聴者
- **管理者**: シーズン・カード・拡張パック管理
- **システム**: 自動集計・統計処理

## 3. 機能要件（Phase 0）

### 3.1 必須機能（Must Have）

#### 3.1.1 ティアリスト管理機能（TierListAggregate）
- **F001: ティアリスト作成（CreateTierList）**
  - 目的: ユーザーがドラッグ&ドロップでティアリストを作成
  - 入力: デッキ選択、ティアランク（SS/S/A/B/C/D/E）配置
  - 出力: ティアリスト（TierList）、共有URL
  - 制約: アクティブシーズン（ActiveSeason）内でのみ作成可能

- **F002: ティアリスト閲覧（GetTierList）**
  - 目的: 作成されたティアリストの閲覧
  - 入力: ティアリストID
  - 出力: ティアリスト表示、ティア配置（TierPlacement）情報

- **F003: ティアリスト一覧（ListTierLists）**
  - 目的: シーズン内のティアリスト一覧表示
  - 入力: シーズンID（任意）
  - 出力: ティアリスト一覧、閲覧数

#### 3.1.2 デッキ管理機能（DeckAggregate）
- **F004: デッキ作成（CreateDeck）**
  - 目的: カードからデッキを作成
  - 入力: カード選択（1-3枚）、ニックネーム
  - 出力: デッキ、合成画像URL
  - 制約: 現在のアクティブシーズンに関連付け

- **F005: カード一覧表示（ListCards）**
  - 目的: デッキ作成時のカード選択
  - 入力: 検索条件（任意）
  - 出力: カード一覧、フィルタ機能

#### 3.1.3 シーズン管理機能（SeasonAggregate）
- **F006: アクティブシーズン取得（GetActiveSeason）**
  - 目的: 現在のアクティブシーズン情報表示
  - 入力: なし
  - 出力: アクティブシーズン情報

- **F007: シーズン一覧（ListSeasons）**
  - 目的: 過去シーズンのティアリスト閲覧
  - 入力: なし
  - 出力: シーズン一覧、期間情報

#### 3.1.4 集計・統計機能（StatisticsCalculation）
- **F008: 集計ティアリスト表示（GetConsensusTierList）**
  - 目的: 全ユーザーの配置データから集計結果表示
  - 入力: シーズンID
  - 出力: 集計ティアリスト（ConsensusTierList）

- **F009: ティア統計表示（TierStatistics）**
  - 目的: デッキのティア配置統計表示
  - 入力: デッキID、シーズンID
  - 出力: 平均ティアランク、配置回数

### 3.2 対象外機能（Phase 0では実装しない）
- ユーザー認証・プロフィール機能
- デッキ詳細分析（DeckDetail）
- コミュニティ機能（User/UserCommunity）
- 高度な統計・トレンド分析

## 4. 非機能要件（Phase 0）

### 4.1 パフォーマンス要件
- **ページ読み込み時間**: 3秒以内
- **API レスポンス時間**: 1秒以内
- **デッキ画像生成時間**: 3秒以内
- **同時ユーザー数**: 100人（初期目標）

### 4.2 スケーラビリティ要件
- **ティアリスト数**: 1,000個対応
- **デッキ数**: 500個対応
- **画像ストレージ**: 10GB対応
- **API リクエスト**: 1万回/日対応

### 4.3 可用性要件
- **稼働率**: 95%以上（月間）
- **計画停止**: 月1回4時間以内
- **障害復旧**: 48時間以内

### 4.4 セキュリティ要件
- **データ暗号化**: TLS 1.3による通信暗号化
- **入力検証**: 全入力の妥当性チェック
- **レート制限**: API制限（匿名ユーザー対応）
- **基本的なセキュリティ対策**: XSS, CSRF対策

### 4.5 ユーザビリティ要件
- **レスポンシブ対応**: モバイル・デスクトップ
- **ブラウザ対応**: Chrome, Firefox, Safari, Edge（最新2バージョン）
- **多言語対応**: 日本語のみ（Phase 0）
- **アクセシビリティ**: 基本的な対応（WCAG 2.1 A準拠）

### 4.6 運用・保守要件
- **バックアップ**: 週次バックアップ
- **ログ保存**: 7日間のアクセスログ
- **監視**: 基本的なシステム監視
- **メンテナンス**: 必要時のみ

## 5. 制約条件（Phase 0）

### 5.1 技術的制約
- **開発言語**: Go（バックエンド）、TypeScript/Next.js（フロントエンド）
- **インフラ**: Cloudflare Pages（フロントエンド）、Cloudflare Workers（バックエンド）
- **データベース**: Cloudflare D1（SQLite互換）
- **ストレージ**: Cloudflare R2（画像保存）

### 5.2 リソース制約
- **開発体制**: 個人開発（1人）
- **開発期間**: 3ヶ月（Phase 0）
- **予算**: 無料枠内（Cloudflare）

### 5.3 機能制約
- **ユーザー認証**: Phase 0では実装しない（匿名利用）
- **管理機能**: 最小限（シーズン・カード・拡張パック管理）
- **高度な統計**: Phase 0では基本的な集計のみ

## 6. リスク・前提条件（Phase 0）

### 6.1 技術的リスク
- **無料枠制限**: Cloudflareの制限による性能劣化
- **画像処理負荷**: デッキ画像生成の負荷
- **SQLite制限**: D1データベースの制約

### 6.2 ビジネスリスク
- **初期ユーザー獲得**: Phase 0での機能限定による利用者数
- **フィードバック収集**: 匿名ユーザーからのフィードバック取得
- **継続開発**: Phase 1以降の開発継続判断

### 6.3 前提条件
- ポケモンカードの適正利用
- 無料枠での安定運用
- コミュニティからの初期フィードバック
